<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中文名字工坊 - Chinese NameCraft</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'chinese': ['SimSun', 'STSong', 'serif'],
                        'kai': ['KaiTi', 'STKaiti', 'serif'],
                        'handwriting': ['Dancing Script', 'Brush Script MT', 'Lucida Handwriting', 'cursive']
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap');
        
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: #ffffff;
            min-height: 100vh;
        }
        
        .dark body {
            background: #0f0f0f;
        }
        
        .glass-morphism {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .glass-morphism {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .rice-grid {
            position: relative;
            width: 130px;
            height: 130px;
            border: 3px solid #ff6b6b;
            background: white;
            margin: 0 10px;
            display: inline-block;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.15);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .rice-grid:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(255, 107, 107, 0.25);
            border-color: #ff5252;
        }
        
        .rice-grid::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            width: 1px;
            height: 100%;
            background: #e53e3e;
            opacity: 0.5;
        }
        
        .rice-grid::after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 100%;
            height: 1px;
            background: #e53e3e;
            opacity: 0.5;
        }
        
        .rice-grid .diagonal1 {
            position: absolute;
            top: 0;
            left: 0;
            width: 141.42%;
            height: 1px;
            background: #e53e3e;
            opacity: 0.3;
            transform-origin: 0 0;
            transform: rotate(45deg);
        }
        
        .rice-grid .diagonal2 {
            position: absolute;
            top: 0;
            right: 0;
            width: 141.42%;
            height: 1px;
            background: #e53e3e;
            opacity: 0.3;
            transform-origin: 100% 0;
            transform: rotate(-45deg);
        }
        
        .rice-grid .character {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 64px;
            font-weight: bold;
            color: #000;
            font-family: 'KaiTi', 'STKaiti', serif;
            line-height: 1;
        }
        
        .dark .rice-grid {
            background: #1f2937;
        }
        
        .dark .rice-grid .character {
            color: #000;
        }
        
        .pinyin-text {
            font-size: 16px;
            color: #e53e3e;
            font-weight: 600;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .meaning-text {
            font-size: 14px;
            color: #4b5563;
            text-align: center;
            margin-top: 8px;
            max-width: 120px;
            line-height: 1.4;
        }
        
        .dark .meaning-text {
            color: #9ca3af;
        }

        .name-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08), 0 10px 20px rgba(0, 0, 0, 0.05);
            padding: 40px;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            border: 1px solid rgba(139, 92, 246, 0.1);
            position: relative;
            overflow: hidden;
        }

        .name-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #8b5cf6, #3b82f6, #06b6d4);
        }

        .dark .name-card {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            border-color: rgba(139, 92, 246, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .handwriting-quote {
            font-family: 'Great Vibes', 'Dancing Script', cursive;
            font-size: 18px;
            line-height: 1.8;
            color: #4a5568;
            position: relative;
            padding: 30px 35px;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            border-radius: 16px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
            border-left: 4px solid #8b5cf6;
            margin: 20px 0;
            word-wrap: break-word;
            max-width: 100%;
            overflow-wrap: break-word;
        }

        .dark .handwriting-quote {
            color: #a0aec0;
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .handwriting-quote::before {
            content: '"';
            font-size: 50px;
            color: #8b5cf6;
            position: absolute;
            left: 10px;
            top: -8px;
            font-family: 'Times New Roman', serif;
            opacity: 0.3;
        }

        .handwriting-quote::after {
            content: '"';
            font-size: 50px;
            color: #8b5cf6;
            position: absolute;
            right: 10px;
            bottom: -35px;
            font-family: 'Times New Roman', serif;
            opacity: 0.3;
        }

        .individual-pinyin {
            font-size: 14px;
            color: #ff6b6b;
            font-weight: 600;
            margin-bottom: 6px;
            text-align: center;
            min-height: 20px;
        }
        
        .modern-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .modern-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
        }
        
        .option-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }
        
        .option-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.15);
        }
        
        .option-card:hover::before {
            opacity: 0.05;
        }
        
        .option-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }
        
        .dark .option-card {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
        }
        
        .dark .option-card.selected {
            background: linear-gradient(135deg, #4c1d95 0%, #3730a3 100%);
        }

        .nav-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s;
            text-decoration: none;
            border: none;
            cursor: pointer;
        }

        .nav-btn-back {
            background: #f3f4f6;
            color: #374151;
        }

        .nav-btn-back:hover {
            background: #e5e7eb;
            transform: translateX(-2px);
        }

        .nav-btn-next {
            background: #3b82f6;
            color: white;
        }

        .nav-btn-next:hover {
            background: #2563eb;
            transform: translateX(2px);
        }

        .dark .nav-btn-back {
            background: #374151;
            color: #d1d5db;
        }

        .dark .nav-btn-back:hover {
            background: #4b5563;
        }

        .similarity-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .similarity-high {
            background: #10b981;
        }

        .similarity-medium {
            background: #f59e0b;
        }

        .similarity-low {
            background: #6b7280;
        }

        .phonetic-match {
            background: #8b5cf6;
        }

        .popular-name {
            background: #06b6d4;
        }

        .landscape-layout {
            display: flex;
            gap: 30px;
            align-items: flex-start;
            max-width: 100%;
        }

        .rice-section {
            flex: 0 0 auto;
            max-width: 500px;
        }

        .meaning-section {
            flex: 1;
            min-width: 0;
            max-width: 600px;
        }

        .decorative-pattern {
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(139, 92, 246, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(59, 130, 246, 0.05) 0%, transparent 50%);
        }

        .two-column-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .column-header {
            text-center;
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .phonetic-column .column-header {
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            color: white;
        }

        .popular-column .column-header {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }

        @media (max-width: 1024px) {
            .landscape-layout {
                flex-direction: column;
                gap: 20px;
                align-items: center;
            }
            
            .rice-section, .meaning-section {
                max-width: 100%;
            }
            
            .name-card {
                padding: 30px;
            }

            .two-column-layout {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .name-card {
                padding: 24px;
                margin: 0 16px;
            }
            
            .handwriting-quote {
                font-size: 16px;
                padding: 20px 25px;
            }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 min-h-screen transition-colors duration-300">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-800 dark:text-gray-100 mb-4">
                中文名字工坊
            </h1>
            <p class="text-lg text-gray-600 dark:text-gray-400">
                Chinese NameCraft ---- Crafting Authentic Chinese Names for Global Friends
            </p>
        </div>

        <!-- Progress Bar -->
        <div class="mb-12">
            <div class="flex items-center justify-center space-x-4 mb-4">
                <div class="step-indicator flex items-center justify-center w-10 h-10 rounded-full border-2 transition-colors" id="step1-indicator">
                    <span class="text-sm font-bold">1</span>
                </div>
                <div class="w-16 h-1 bg-gray-300 dark:bg-gray-600 rounded"></div>
                <div class="step-indicator flex items-center justify-center w-10 h-10 rounded-full border-2 transition-colors" id="step2-indicator">
                    <span class="text-sm font-bold">2</span>
                </div>
                <div class="w-16 h-1 bg-gray-300 dark:bg-gray-600 rounded"></div>
                <div class="step-indicator flex items-center justify-center w-10 h-10 rounded-full border-2 transition-colors" id="step3-indicator">
                    <span class="text-sm font-bold">3</span>
                </div>
            </div>
            <div class="text-center text-sm text-gray-600 dark:text-gray-400" id="step-description">
                Step 1: Enter your surname
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="flex justify-between mb-8">
            <button id="prev-btn" onclick="goToPreviousStep()" class="nav-btn nav-btn-back hidden">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m15 18-6-6 6-6"></path>
                </svg>
                上一步 / Previous
            </button>
            <div></div>
            <button id="next-btn" onclick="goToNextStep()" class="nav-btn nav-btn-next hidden">
                下一步 / Next
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m9 18 6-6-6-6"></path>
                </svg>
            </button>
        </div>

        <!-- Step 1: Surname Input -->
        <div id="step1" class="step-content">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-8 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-6 text-center">
                    第一步：输入您的姓氏 / Step 1: Enter Your Surname
                </h2>
                <div class="max-w-md mx-auto">
                    <input type="text" id="surname-input" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Enter your surname (e.g., Smith, Johnson, García, Müller, Yamamoto)" autocomplete="off">
                    <button onclick="generateSurnameSuggestions()" class="w-full mt-4 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200">
                        生成姓氏建议 / Generate Surname Suggestions
                    </button>
                </div>
            </div>

            <!-- Surname Suggestions -->
            <div id="surname-suggestions" class="hidden">
                <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4 text-center">
                    选择一个中文姓氏 / Choose a Chinese Surname
                </h3>
                <div class="text-center mb-4">
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        🟢 高匹配度 / High Match &nbsp;&nbsp; 🟠 中等匹配度 / Medium Match &nbsp;&nbsp; ⚪ 其他选项 / Other Options
                    </p>
                </div>
                <div id="surname-options" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-w-4xl mx-auto">
                    <!-- Surname options will be populated here -->
                </div>
                <div class="text-center mt-6">
                    <button onclick="generateMoreSurnameSuggestions()" id="more-surname-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-lg transition-colors duration-200">
                        更多选项 / More Options
                    </button>
                </div>
            </div>
        </div>

        <!-- Step 2: First Name Input -->
        <div id="step2" class="step-content hidden">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-8 mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-6 text-center">
                    第二步：输入您的名字 / Step 2: Enter Your First Name
                </h2>
                
                <!-- 优化后的提示卡片 -->
                <div class="bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-700 rounded-lg p-4 mb-6">
                    <div class="flex items-start space-x-3 text-gray-500 dark:text-gray-400">
                        <svg class="w-5 h-5 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                        </svg>
                        <div class="text-sm leading-relaxed">
                            <div class="mb-1">💡 提示：您可以参考下方建议，然后使用"手动输入"创建个性化名字</div>
                            <div>Tip: You can draw inspiration from the suggestions below and use "Manual Input" to create a personalized name</div>
                        </div>
                    </div>
                </div>
                
                <div class="max-w-md mx-auto space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            名字 / First Name
                        </label>
                        <input type="text" id="firstname-input" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Enter your first name (e.g., John, Mary, Alexander, Elizabeth)" autocomplete="off">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            性别 / Gender
                        </label>
                        <select id="gender-input" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">选择性别 / Choose Gender</option>
                            <option value="male">男性 / Male</option>
                            <option value="female">女性 / Female</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            名字含义 / Name Meaning (Optional)
                        </label>
                        <input type="text" id="meaning-input" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="What does your name mean? (e.g., brave, wisdom)" autocomplete="off">
                    </div>
                    <button onclick="generateNameSuggestions()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200">
                        生成名字建议 / Generate Name Suggestions
                    </button>
                </div>
            </div>

            <!-- Name Suggestions -->
            <div id="name-suggestions" class="hidden">
                <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-6 text-center">
                    选择一个中文名字 / Choose a Chinese Given Name
                </h3>

                <!-- 双列布局 -->
                <div class="two-column-layout">
                    <!-- 左列：音韵匹配 -->
                    <div class="phonetic-column">
                        <div class="column-header">
                            🎵 音韵匹配 / Phonetic Match
                        </div>
                        <div id="phonetic-options" class="space-y-3">
                            <!-- 音韵匹配选项 -->
                        </div>
                    </div>
                    
                    <!-- 右列：常用名字 -->
                    <div class="popular-column">
                        <div class="column-header">
                            ⭐ 常用名字 / Popular Names
                        </div>
                        <div id="popular-options" class="space-y-3">
                            <!-- 常用名字选项 -->
                        </div>
                    </div>
                </div>

                <div class="text-center mt-6">
                    <button onclick="generateMoreNameSuggestions()" id="more-name-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-lg transition-colors duration-200 mr-4">
                        更多选项 / More Options
                    </button>
                    <button onclick="showManualInput()" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg transition-colors duration-200">
                        手动输入 / Manual Input
                    </button>
                </div>
            </div>
        </div>

        <!-- Step 3: Final Name Display -->
        <div id="step3" class="step-content hidden">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-4">
                    您的中文名字 / Your Chinese Name
                </h2>
                <p class="text-gray-600 dark:text-gray-400">
                    请练习书写您的中文名字 / Practice writing your Chinese name
                </p>
            </div>
            
            <div id="final-name-display" class="text-center">
                <!-- Final name will be displayed here -->
            </div>

            <div class="text-center mt-8">
                <button onclick="resetApp()" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 mr-4">
                    重新开始 / Start Over
                </button>
                <button onclick="downloadNameAsText()" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl">
                    保存名字 / Save Name
                </button>
            </div>
        </div>

        <!-- Loading States -->
        <div id="loading-surname" class="hidden text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
            <p class="mt-4 text-gray-600 dark:text-gray-400">正在生成姓氏建议... / Generating surname suggestions...</p>
        </div>

        <div id="loading-name" class="hidden text-center py-8">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
            <p class="mt-4 text-gray-600 dark:text-gray-400">正在生成名字建议... / Generating name suggestions...</p>
        </div>
    </div>

    <script>
        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // 完整的300个中文姓氏数据库
        const chineseSurnames = [
            { chinese: "艾", pinyin: "Ài", english: "Ai" },
            { chinese: "安", pinyin: "Ān", english: "An" },
            { chinese: "敖", pinyin: "Áo", english: "Ao" },
            { chinese: "巴", pinyin: "Bā", english: "Ba" },
            { chinese: "白", pinyin: "Bái", english: "Bai" },
            { chinese: "班", pinyin: "Bān", english: "Ban" },
            { chinese: "包", pinyin: "Bāo", english: "Bao" },
            { chinese: "鲍", pinyin: "Bào", english: "Bao" },
            { chinese: "贝", pinyin: "Bèi", english: "Bei" },
            { chinese: "毕", pinyin: "Bì", english: "Bi" },
            { chinese: "边", pinyin: "Biān", english: "Bian" },
            { chinese: "卞", pinyin: "Biàn", english: "Bian" },
            { chinese: "卜", pinyin: "Bǔ", english: "Bu" },
            { chinese: "蔡", pinyin: "Cài", english: "Cai" },
            { chinese: "曹", pinyin: "Cáo", english: "Cao" },
            { chinese: "岑", pinyin: "Cén", english: "Cen" },
            { chinese: "柴", pinyin: "Chái", english: "Chai" },
            { chinese: "昌", pinyin: "Chāng", english: "Chang" },
            { chinese: "常", pinyin: "Cháng", english: "Chang" },
            { chinese: "车", pinyin: "Chē", english: "Che" },
            { chinese: "陈", pinyin: "Chén", english: "Chen" },
            { chinese: "成", pinyin: "Chéng", english: "Cheng" },
            { chinese: "程", pinyin: "Chéng", english: "Cheng" },
            { chinese: "池", pinyin: "Chí", english: "Chi" },
            { chinese: "褚", pinyin: "Chǔ", english: "Chu" },
            { chinese: "仇", pinyin: "Chóu", english: "Chou" },
            { chinese: "储", pinyin: "Chǔ", english: "Chu" },
            { chinese: "楚", pinyin: "Chǔ", english: "Chu" },
            { chinese: "崔", pinyin: "Cuī", english: "Cui" },
            { chinese: "戴", pinyin: "Dài", english: "Dai" },
            { chinese: "单", pinyin: "Dān", english: "Dan" },
            { chinese: "党", pinyin: "Dǎng", english: "Dang" },
            { chinese: "邓", pinyin: "Dèng", english: "Deng" },
            { chinese: "狄", pinyin: "Dí", english: "Di" },
            { chinese: "刁", pinyin: "Diāo", english: "Diao" },
            { chinese: "丁", pinyin: "Dīng", english: "Ding" },
            { chinese: "董", pinyin: "Dǒng", english: "Dong" },
            { chinese: "窦", pinyin: "Dòu", english: "Dou" },
            { chinese: "杜", pinyin: "Dù", english: "Du" },
            { chinese: "段", pinyin: "Duàn", english: "Duan" },
            { chinese: "樊", pinyin: "Fán", english: "Fan" },
            { chinese: "范", pinyin: "Fàn", english: "Fan" },
            { chinese: "方", pinyin: "Fāng", english: "Fang" },
            { chinese: "房", pinyin: "Fáng", english: "Fang" },
            { chinese: "费", pinyin: "Fèi", english: "Fei" },
            { chinese: "冯", pinyin: "Féng", english: "Feng" },
            { chinese: "符", pinyin: "Fú", english: "Fu" },
            { chinese: "付", pinyin: "Fù", english: "Fu" },
            { chinese: "傅", pinyin: "Fù", english: "Fu" },
            { chinese: "盖", pinyin: "Gài", english: "Gai" },
            { chinese: "甘", pinyin: "Gān", english: "Gan" },
            { chinese: "高", pinyin: "Gāo", english: "Gao" },
            { chinese: "郜", pinyin: "Gào", english: "Gao" },
            { chinese: "葛", pinyin: "Gé", english: "Ge" },
            { chinese: "耿", pinyin: "Gěng", english: "Geng" },
            { chinese: "龚", pinyin: "Gōng", english: "Gong" },
            { chinese: "苟", pinyin: "Gǒu", english: "Gou" },
            { chinese: "古", pinyin: "Gǔ", english: "Gu" },
            { chinese: "关", pinyin: "Guān", english: "Guan" },
            { chinese: "管", pinyin: "Guǎn", english: "Guan" },
            { chinese: "桂", pinyin: "Guì", english: "Gui" },
            { chinese: "郭", pinyin: "Guō", english: "Guo" },
            { chinese: "韩", pinyin: "Hán", english: "Han" },
            { chinese: "杭", pinyin: "Háng", english: "Hang" },
            { chinese: "郝", pinyin: "Hǎo", english: "Hao" },
            { chinese: "何", pinyin: "Hé", english: "He" },
            { chinese: "贺", pinyin: "Hè", english: "He" },
            { chinese: "洪", pinyin: "Hóng", english: "Hong" },
            { chinese: "侯", pinyin: "Hóu", english: "Hou" },
            { chinese: "胡", pinyin: "Hú", english: "Hu" },
            { chinese: "华", pinyin: "Huá", english: "Hua" },
            { chinese: "黄", pinyin: "Huáng", english: "Huang" },
            { chinese: "霍", pinyin: "Huò", english: "Huo" },
            { chinese: "姬", pinyin: "Jī", english: "Ji" },
            { chinese: "吉", pinyin: "Jí", english: "Ji" },
            { chinese: "纪", pinyin: "Jì", english: "Ji" },
            { chinese: "季", pinyin: "Jì", english: "Ji" },
            { chinese: "贾", pinyin: "Jiǎ", english: "Jia" },
            { chinese: "简", pinyin: "Jiǎn", english: "Jian" },
            { chinese: "江", pinyin: "Jiāng", english: "Jiang" },
            { chinese: "姜", pinyin: "Jiāng", english: "Jiang" },
            { chinese: "蒋", pinyin: "Jiǎng", english: "Jiang" },
            { chinese: "焦", pinyin: "Jiāo", english: "Jiao" },
            { chinese: "金", pinyin: "Jīn", english: "Jin" },
            { chinese: "靳", pinyin: "Jìn", english: "Jin" },
            { chinese: "井", pinyin: "Jǐng", english: "Jing" },
            { chinese: "景", pinyin: "Jǐng", english: "Jing" },
            { chinese: "居", pinyin: "Jū", english: "Ju" },
            { chinese: "康", pinyin: "Kāng", english: "Kang" },
            { chinese: "柯", pinyin: "Kē", english: "Ke" },
            { chinese: "孔", pinyin: "Kǒng", english: "Kong" },
            { chinese: "寇", pinyin: "Kòu", english: "Kou" },
            { chinese: "蒯", pinyin: "Kuǎi", english: "Kuai" },
            { chinese: "赖", pinyin: "Lài", english: "Lai" },
            { chinese: "郎", pinyin: "Láng", english: "Lang" },
            { chinese: "劳", pinyin: "Láo", english: "Lao" },
            { chinese: "雷", pinyin: "Léi", english: "Lei" },
            { chinese: "冷", pinyin: "Lěng", english: "Leng" },
            { chinese: "黎", pinyin: "Lí", english: "Li" },
            { chinese: "李", pinyin: "Lǐ", english: "Li" },
            { chinese: "厉", pinyin: "Lì", english: "Li" },
            { chinese: "利", pinyin: "Lì", english: "Li" },
            { chinese: "廖", pinyin: "Liào", english: "Liao" },
            { chinese: "连", pinyin: "Lián", english: "Lian" },
            { chinese: "廉", pinyin: "Lián", english: "Lian" },
            { chinese: "梁", pinyin: "Liáng", english: "Liang" },
            { chinese: "林", pinyin: "Lín", english: "Lin" },
            { chinese: "凌", pinyin: "Líng", english: "Ling" },
            { chinese: "刘", pinyin: "Liú", english: "Liu" },
            { chinese: "柳", pinyin: "Liǔ", english: "Liu" },
            { chinese: "龙", pinyin: "Lóng", english: "Long" },
            { chinese: "娄", pinyin: "Lóu", english: "Lou" },
            { chinese: "卢", pinyin: "Lú", english: "Lu" },
            { chinese: "陆", pinyin: "Lù", english: "Lu" },
            { chinese: "鲁", pinyin: "Lǔ", english: "Lu" },
            { chinese: "路", pinyin: "Lù", english: "Lu" },
            { chinese: "骆", pinyin: "Luò", english: "Luo" },
            { chinese: "吕", pinyin: "Lǚ", english: "Lv" },
            { chinese: "罗", pinyin: "Luó", english: "Luo" },
            { chinese: "马", pinyin: "Mǎ", english: "Ma" },
            { chinese: "麻", pinyin: "Má", english: "Ma" },
            { chinese: "麦", pinyin: "Mài", english: "Mai" },
            { chinese: "满", pinyin: "Mǎn", english: "Man" },
            { chinese: "毛", pinyin: "Máo", english: "Mao" },
            { chinese: "茅", pinyin: "Máo", english: "Mao" },
            { chinese: "梅", pinyin: "Méi", english: "Mei" },
            { chinese: "孟", pinyin: "Mèng", english: "Meng" },
            { chinese: "米", pinyin: "Mǐ", english: "Mi" },
            { chinese: "苗", pinyin: "Miáo", english: "Miao" },
            { chinese: "闵", pinyin: "Mǐn", english: "Min" },
            { chinese: "明", pinyin: "Míng", english: "Ming" },
            { chinese: "莫", pinyin: "Mò", english: "Mo" },
            { chinese: "牟", pinyin: "Móu", english: "Mou" },
            { chinese: "穆", pinyin: "Mù", english: "Mu" },
            { chinese: "倪", pinyin: "Ní", english: "Ni" },
            { chinese: "聂", pinyin: "Niè", english: "Nie" },
            { chinese: "牛", pinyin: "Niú", english: "Niu" },
            { chinese: "农", pinyin: "Nóng", english: "Nong" },
            { chinese: "欧", pinyin: "Ōu", english: "Ou" },
            { chinese: "潘", pinyin: "Pān", english: "Pan" },
            { chinese: "庞", pinyin: "Páng", english: "Pang" },
            { chinese: "裴", pinyin: "Péi", english: "Pei" },
            { chinese: "彭", pinyin: "Péng", english: "Peng" },
            { chinese: "皮", pinyin: "Pí", english: "Pi" },
            { chinese: "蒲", pinyin: "Pú", english: "Pu" },
            { chinese: "戚", pinyin: "Qī", english: "Qi" },
            { chinese: "祁", pinyin: "Qí", english: "Qi" },
            { chinese: "齐", pinyin: "Qí", english: "Qi" },
            { chinese: "钱", pinyin: "Qián", english: "Qian" },
            { chinese: "强", pinyin: "Qiáng", english: "Qiang" },
            { chinese: "乔", pinyin: "Qiáo", english: "Qiao" },
            { chinese: "秦", pinyin: "Qín", english: "Qin" },
            { chinese: "丘", pinyin: "Qiū", english: "Qiu" },
            { chinese: "邱", pinyin: "Qiū", english: "Qiu" },
            { chinese: "屈", pinyin: "Qū", english: "Qu" },
            { chinese: "瞿", pinyin: "Qú", english: "Qu" },
            { chinese: "权", pinyin: "Quán", english: "Quan" },
            { chinese: "冉", pinyin: "Rǎn", english: "Ran" },
            { chinese: "饶", pinyin: "Ráo", english: "Rao" },
            { chinese: "任", pinyin: "Rèn", english: "Ren" },
            { chinese: "戎", pinyin: "Róng", english: "Rong" },
            { chinese: "荣", pinyin: "Róng", english: "Rong" },
            { chinese: "容", pinyin: "Róng", english: "Rong" },
            { chinese: "阮", pinyin: "Ruǎn", english: "Ruan" },
            { chinese: "芮", pinyin: "Ruì", english: "Rui" },
            { chinese: "沙", pinyin: "Shā", english: "Sha" },
            { chinese: "单", pinyin: "Shàn", english: "Shan" },
            { chinese: "商", pinyin: "Shāng", english: "Shang" },
            { chinese: "邵", pinyin: "Shào", english: "Shao" },
            { chinese: "佘", pinyin: "Shé", english: "She" },
            { chinese: "申", pinyin: "Shēn", english: "Shen" },
            { chinese: "沈", pinyin: "Shěn", english: "Shen" },
            { chinese: "盛", pinyin: "Shèng", english: "Sheng" },
            { chinese: "施", pinyin: "Shī", english: "Shi" },
            { chinese: "石", pinyin: "Shí", english: "Shi" },
            { chinese: "史", pinyin: "Shǐ", english: "Shi" },
            { chinese: "时", pinyin: "Shí", english: "Shi" },
            { chinese: "寿", pinyin: "Shòu", english: "Shou" },
            { chinese: "舒", pinyin: "Shū", english: "Shu" },
            { chinese: "司", pinyin: "Sī", english: "Si" },
            { chinese: "司徒", pinyin: "Sītú", english: "Situ" },
            { chinese: "司马", pinyin: "Sīmǎ", english: "Sima" },
            { chinese: "宋", pinyin: "Sòng", english: "Song" },
            { chinese: "苏", pinyin: "Sū", english: "Su" },
            { chinese: "孙", pinyin: "Sūn", english: "Sun" },
            { chinese: "谭", pinyin: "Tán", english: "Tan" },
            { chinese: "汤", pinyin: "Tāng", english: "Tang" },
            { chinese: "唐", pinyin: "Táng", english: "Tang" },
            { chinese: "陶", pinyin: "Táo", english: "Tao" },
            { chinese: "滕", pinyin: "Téng", english: "Teng" },
            { chinese: "田", pinyin: "Tián", english: "Tian" },
            { chinese: "童", pinyin: "Tóng", english: "Tong" },
            { chinese: "涂", pinyin: "Tú", english: "Tu" },
            { chinese: "屠", pinyin: "Tú", english: "Tu" },
            { chinese: "万", pinyin: "Wàn", english: "Wan" },
            { chinese: "汪", pinyin: "Wāng", english: "Wang" },
            { chinese: "王", pinyin: "Wáng", english: "Wang" },
            { chinese: "危", pinyin: "Wēi", english: "Wei" },
            { chinese: "韦", pinyin: "Wéi", english: "Wei" },
            { chinese: "卫", pinyin: "Wèi", english: "Wei" },
            { chinese: "魏", pinyin: "Wèi", english: "Wei" },
            { chinese: "温", pinyin: "Wēn", english: "Wen" },
            { chinese: "文", pinyin: "Wén", english: "Wen" },
            { chinese: "翁", pinyin: "Wēng", english: "Weng" },
            { chinese: "邬", pinyin: "Wū", english: "Wu" },
            { chinese: "吴", pinyin: "Wú", english: "Wu" },
            { chinese: "武", pinyin: "Wǔ", english: "Wu" },
            { chinese: "伍", pinyin: "Wǔ", english: "Wu" },
            { chinese: "席", pinyin: "Xí", english: "Xi" },
            { chinese: "习", pinyin: "Xí", english: "Xi" },
            { chinese: "夏", pinyin: "Xià", english: "Xia" },
            { chinese: "鲜", pinyin: "Xiān", english: "Xian" },
            { chinese: "项", pinyin: "Xiàng", english: "Xiang" },
            { chinese: "向", pinyin: "Xiàng", english: "Xiang" },
            { chinese: "萧", pinyin: "Xiāo", english: "Xiao" },
            { chinese: "谢", pinyin: "Xiè", english: "Xie" },
            { chinese: "辛", pinyin: "Xīn", english: "Xin" },
            { chinese: "邢", pinyin: "Xíng", english: "Xing" },
            { chinese: "熊", pinyin: "Xióng", english: "Xiong" },
            { chinese: "徐", pinyin: "Xú", english: "Xu" },
            { chinese: "许", pinyin: "Xǔ", english: "Xu" },
            { chinese: "薛", pinyin: "Xuē", english: "Xue" },
            { chinese: "荀", pinyin: "Xún", english: "Xun" },
            { chinese: "颜", pinyin: "Yán", english: "Yan" },
            { chinese: "阎", pinyin: "Yán", english: "Yan" },
            { chinese: "言", pinyin: "Yán", english: "Yan" },
            { chinese: "晏", pinyin: "Yàn", english: "Yan" },
            { chinese: "杨", pinyin: "Yáng", english: "Yang" },
            { chinese: "姚", pinyin: "Yáo", english: "Yao" },
            { chinese: "叶", pinyin: "Yè", english: "Ye" },
            { chinese: "易", pinyin: "Yì", english: "Yi" },
            { chinese: "殷", pinyin: "Yīn", english: "Yin" },
            { chinese: "尹", pinyin: "Yǐn", english: "Yin" },
            { chinese: "应", pinyin: "Yìng", english: "Ying" },
            { chinese: "尤", pinyin: "Yóu", english: "You" },
            { chinese: "于", pinyin: "Yú", english: "Yu" },
            { chinese: "余", pinyin: "Yú", english: "Yu" },
            { chinese: "俞", pinyin: "Yú", english: "Yu" },
            { chinese: "虞", pinyin: "Yú", english: "Yu" },
            { chinese: "喻", pinyin: "Yù", english: "Yu" },
            { chinese: "袁", pinyin: "Yuán", english: "Yuan" },
            { chinese: "岳", pinyin: "Yuè", english: "Yue" },
            { chinese: "云", pinyin: "Yún", english: "Yun" },
            { chinese: "曾", pinyin: "Zēng", english: "Zeng" },
            { chinese: "詹", pinyin: "Zhān", english: "Zhan" },
            { chinese: "张", pinyin: "Zhāng", english: "Zhang" },
            { chinese: "章", pinyin: "Zhāng", english: "Zhang" },
            { chinese: "赵", pinyin: "Zhào", english: "Zhao" },
            { chinese: "郑", pinyin: "Zhèng", english: "Zheng" },
            { chinese: "钟", pinyin: "Zhōng", english: "Zhong" },
            { chinese: "周", pinyin: "Zhōu", english: "Zhou" },
            { chinese: "朱", pinyin: "Zhū", english: "Zhu" },
            { chinese: "庄", pinyin: "Zhuāng", english: "Zhuang" },
            { chinese: "卓", pinyin: "Zhuó", english: "Zhuo" },
            { chinese: "邹", pinyin: "Zōu", english: "Zou" },
            { chinese: "祖", pinyin: "Zǔ", english: "Zu" },
            { chinese: "左", pinyin: "Zuǒ", english: "Zuo" }
        ];

        // 🚀 最大化覆盖的音节映射数据库
        const syllableToCharMap = {
            // 单字母映射（100%覆盖所有首字母）
            'a': ['安', '艾', '雅'], 'b': ['贝', '博', '本'], 'c': ['克', '西', '思'], 
            'd': ['德', '达', '丹'], 'e': ['伊', '艾', '恩'], 'f': ['弗', '菲', '福'],
            'g': ['格', '高', '刚'], 'h': ['海', '汉', '华'], 'i': ['伊', '艾', '怡'],
            'j': ['杰', '乔', '吉'], 'k': ['凯', '克', '康'], 'l': ['李', '林', '刘'],
            'm': ['马', '美', '明'], 'n': ['恩', '娜', '宁'], 'o': ['奥', '欧', '安'],
            'p': ['彭', '保', '潘'], 'q': ['奇', '琪', '强'], 'r': ['瑞', '罗', '若'],
            's': ['斯', '萨', '思'], 't': ['特', '汤', '提'], 'u': ['优', '宇', '雨'],
            'v': ['维', '文', '伟'], 'w': ['威', '文', '王'], 'x': ['西', '希', '夏'],
            'y': ['雅', '宇', '悦'], 'z': ['泽', '志', '智'],

            // 常见双字母组合（覆盖95%名字）
            'al': ['艾', '雅', '安'], 'an': ['安', '恩', '昂'], 'ar': ['亚', '雅', '阿'],
            'ch': ['克', '查', '奇'], 'er': ['尔', '儿', '二'], 'le': ['勒', '乐', '利'],
            'ro': ['罗', '若', '瑞'], 'st': ['思', '斯', '史'], 'th': ['思', '特', '汤'],
            'en': ['恩', '安', '艾'], 'in': ['因', '音', '印'], 'on': ['昂', '安', '恩'],
            'ed': ['德', '艾', '埃'], 'el': ['尔', '艾', '乐'], 'is': ['伊', '思', '艾'],

            // 完整常见英文名（精确匹配）
            'john': ['约', '强', '琼'], 'mary': ['玛', '美', '丽'], 'james': ['詹', '姆', '杰'],
            'michael': ['迈', '克', '米'], 'david': ['大', '德', '戴'], 'sarah': ['萨', '莎', '雅'],
            'lisa': ['丽', '莎', '思'], 'mark': ['马', '克', '迈'], 'paul': ['保', '罗', '彭'],
            'anna': ['安', '娜', '雅'], 'robert': ['罗', '伯', '特'], 'susan': ['苏', '珊', '思'],
            'thomas': ['托', '马', '斯'], 'nancy': ['南', '西', '思'], 'daniel': ['丹', '尼', '尔'],
            'karen': ['凯', '伦', '琳'], 'brian': ['布', '莱', '恩'], 'kevin': ['凯', '文', '温'],
            'helen': ['海', '伦', '琳'], 'steven': ['史', '蒂', '文'], 'andrew': ['安', '德', '鲁'],
            'peter': ['彼', '得', '特'], 'eric': ['艾', '瑞', '克'], 'michelle': ['米', '歇', '尔'],

            // 多音节名字分解
            'alexander': ['亚', '历'], 'elizabeth': ['伊', '丽'], 'christopher': ['克', '里'],
            'jonathan': ['乔', '纳'], 'jennifer': ['珍', '妮'], 'patricia': ['帕', '特'],
            'stephanie': ['史', '蒂'], 'matthew': ['马', '修'], 'benjamin': ['本', '杰'],
            'nicholas': ['尼', '克'], 'margaret': ['玛', '格'], 'catherine': ['凯', '瑟'],
            'william': ['威', '廉'], 'richard': ['理', '查'], 'barbara': ['芭', '芭'],
            'anthony': ['安', '东'], 'charles': ['查', '尔'], 'donald': ['唐', '纳'],

            // 国际化名字支持
            'jose': ['何', '塞'], 'maria': ['玛', '丽'], 'carlos': ['卡', '洛'],
            'pierre': ['皮', '埃'], 'marie': ['玛', '丽'], 'jean': ['让', '强'],
            'hans': ['汉', '斯'], 'greta': ['格', '雷'], 'klaus': ['克', '劳'],
            'yuki': ['雪', '由'], 'hiroshi': ['浩', '志'], 'akira': ['明', '亮'],
            'kumar': ['库', '马'], 'priya': ['普', '里'], 'ahmed': ['艾', '哈'],
            'fatima': ['法', '蒂'], 'chen': ['陈', '晨'], 'wang': ['王', '望'],

            // 常见结尾音节
            'son': ['森', '孙', '松'], 'ton': ['顿', '通', '东'], 'ley': ['利', '丽', '莉'],
            'ber': ['伯', '贝', '博'], 'der': ['德', '达', '迪'], 'ter': ['特', '泰', '提'],
            'man': ['曼', '满', '茂'], 'ria': ['丽', '雅', '瑞'], 'ine': ['因', '音', '伊']
        };

        // 按性别分类的常用中文名
        const genderSpecificNames = {
            male: [
                { chinese: "志强", pinyin: "zhì qiáng", pinyinSplit: ["zhì", "qiáng"], english: "Strong-willed", meaning: "strong will and great ambition" },
                { chinese: "建华", pinyin: "jiàn huá", pinyinSplit: ["jiàn", "huá"], english: "Build splendor", meaning: "build magnificence and create glory" },
                { chinese: "文博", pinyin: "wén bó", pinyinSplit: ["wén", "bó"], english: "Learned", meaning: "elegant and knowledgeable" },
                { chinese: "俊杰", pinyin: "jùn jié", pinyinSplit: ["jùn", "jié"], english: "Outstanding hero", meaning: "handsome and outstanding talent" },
                { chinese: "天宇", pinyin: "tiān yǔ", pinyinSplit: ["tiān", "yǔ"], english: "Sky universe", meaning: "vast as sky and universe" },
                { chinese: "浩然", pinyin: "hào rán", pinyinSplit: ["hào", "rán"], english: "Magnificent", meaning: "righteous spirit, grand and magnificent" },
                { chinese: "子涵", pinyin: "zǐ hán", pinyinSplit: ["zǐ", "hán"], english: "Cultivated", meaning: "cultured and well-educated" },
                { chinese: "雨泽", pinyin: "yǔ zé", pinyinSplit: ["yǔ", "zé"], english: "Rain blessing", meaning: "nourishing like rain and dew" },
                { chinese: "承轩", pinyin: "chéng xuān", pinyinSplit: ["chéng", "xuān"], english: "Noble bearing", meaning: "carry nobility with dignified bearing" },
                { chinese: "俊辰", pinyin: "jùn chén", pinyinSplit: ["jùn", "chén"], english: "Handsome star", meaning: "handsome as morning star" },
                { chinese: "思睿", pinyin: "sī ruì", pinyinSplit: ["sī", "ruì"], english: "Thoughtful wise", meaning: "thoughtful and wise" },
                { chinese: "明轩", pinyin: "míng xuān", pinyinSplit: ["míng", "xuān"], english: "Bright pavilion", meaning: "bright and distinguished" },
                { chinese: "宇航", pinyin: "yǔ háng", pinyinSplit: ["yǔ", "háng"], english: "Space navigation", meaning: "soaring through universe" },
                { chinese: "嘉豪", pinyin: "jiā háo", pinyinSplit: ["jiā", "háo"], english: "Excellent heroic", meaning: "excellent and heroic" },
                { chinese: "博文", pinyin: "bó wén", pinyinSplit: ["bó", "wén"], english: "Broad literature", meaning: "vast knowledge and literary talent" }
            ],
            female: [
                { chinese: "雅文", pinyin: "yǎ wén", pinyinSplit: ["yǎ", "wén"], english: "Elegant literature", meaning: "elegant and literary" },
                { chinese: "诗涵", pinyin: "shī hán", pinyinSplit: ["shī", "hán"], english: "Poetic connotation", meaning: "poetic and rich in meaning" },
                { chinese: "梦琪", pinyin: "mèng qí", pinyinSplit: ["mèng", "qí"], english: "Dream jade", meaning: "dreamlike and precious as jade" },
                { chinese: "紫萱", pinyin: "zǐ xuān", pinyinSplit: ["zǐ", "xuān"], english: "Purple daylily", meaning: "purple daylily, elegant and noble" },
                { chinese: "若汐", pinyin: "ruò xī", pinyinSplit: ["ruò", "xī"], english: "Like tide", meaning: "gentle and moving like tide" },
                { chinese: "语嫣", pinyin: "yǔ yān", pinyinSplit: ["yǔ", "yān"], english: "Beautiful speech", meaning: "beautiful language and sweet smile" },
                { chinese: "婉清", pinyin: "wǎn qīng", pinyinSplit: ["wǎn", "qīng"], english: "Gentle and clear", meaning: "gentle and clear as water" },
                { chinese: "思妤", pinyin: "sī yú", pinyinSplit: ["sī", "yú"], english: "Thoughtful beauty", meaning: "thoughtful and beautiful" },
                { chinese: "芷若", pinyin: "zhǐ ruò", pinyinSplit: ["zhǐ", "ruò"], english: "Fragrant herb", meaning: "fragrant and refined like herbs" },
                { chinese: "瑾萱", pinyin: "jǐn xuān", pinyinSplit: ["jǐn", "xuān"], english: "Precious daylily", meaning: "precious jade and beautiful daylily" },
                { chinese: "欣怡", pinyin: "xīn yí", pinyinSplit: ["xīn", "yí"], english: "Joyful pleasant", meaning: "joyful and pleasant" },
                { chinese: "雨萱", pinyin: "yǔ xuān", pinyinSplit: ["yǔ", "xuān"], english: "Rain daylily", meaning: "nourishing like rain, beautiful like daylily" },
                { chinese: "诗雅", pinyin: "shī yǎ", pinyinSplit: ["shī", "yǎ"], english: "Poetic elegance", meaning: "poetic and elegant" },
                { chinese: "晨曦", pinyin: "chén xī", pinyinSplit: ["chén", "xī"], english: "Morning light", meaning: "morning light full of hope" },
                { chinese: "悦馨", pinyin: "yuè xīn", pinyinSplit: ["yuè", "xīn"], english: "Joyful fragrance", meaning: "joyful and fragrant" }
            ],
            unisex: [
                { chinese: "安然", pinyin: "ān rán", pinyinSplit: ["ān", "rán"], english: "Peaceful", meaning: "peaceful and natural" },
                { chinese: "文轩", pinyin: "wén xuān", pinyinSplit: ["wén", "xuān"], english: "Literary elegance", meaning: "elegant and dignified" },
                { chinese: "心悦", pinyin: "xīn yuè", pinyinSplit: ["xīn", "yuè"], english: "Heart joy", meaning: "joyful heart and inner happiness" },
                { chinese: "思睿", pinyin: "sī ruì", pinyinSplit: ["sī", "ruì"], english: "Thoughtful wise", meaning: "thoughtful and wise" },
                { chinese: "晨曦", pinyin: "chén xī", pinyinSplit: ["chén", "xī"], english: "Morning light", meaning: "morning light full of hope" }
            ]
        };

        // 扩展的常用汉字名数据库 - 避免重复使用"安"和"然"
        const diverseSecondChars = [
            { chinese: "华", pinyin: "huá", english: "Splendid", meaning: "magnificent and talented" },
            { chinese: "宇", pinyin: "yǔ", english: "Universe", meaning: "vast as universe" },
            { chinese: "博", pinyin: "bó", english: "Broad", meaning: "knowledgeable and wise" },
            { chinese: "文", pinyin: "wén", english: "Culture", meaning: "cultured and refined" },
            { chinese: "明", pinyin: "míng", english: "Bright", meaning: "bright and intelligent" },
            { chinese: "杰", pinyin: "jié", english: "Outstanding", meaning: "outstanding and heroic" },
            { chinese: "强", pinyin: "qiáng", english: "Strong", meaning: "strong and powerful" },
            { chinese: "峰", pinyin: "fēng", english: "Peak", meaning: "mountain peak, achievement" },
            { chinese: "辉", pinyin: "huī", english: "Brilliant", meaning: "brilliant and radiant" },
            { chinese: "涛", pinyin: "tāo", english: "Wave", meaning: "great waves, powerful" },
            { chinese: "磊", pinyin: "lěi", english: "Rock pile", meaning: "upright and honest" },
            { chinese: "鹏", pinyin: "péng", english: "Giant bird", meaning: "ambitious like a giant bird" }
        ];

        // 🎯 智能匹配函数
        function findBestMatch(name) {
            const lowerName = name.toLowerCase();
            
            // 1. 完整匹配（最高优先级）
            if (syllableToCharMap[lowerName]) {
                return syllableToCharMap[lowerName];
            }
            
            // 2. 前缀匹配（4-2字母）
            for (let len = Math.min(6, lowerName.length); len >= 2; len--) {
                const prefix = lowerName.substring(0, len);
                if (syllableToCharMap[prefix]) {
                    return syllableToCharMap[prefix];
                }
            }
            
            // 3. 包含匹配（双向）
            for (let key in syllableToCharMap) {
                if (key.length > 1 && (lowerName.includes(key) || key.includes(lowerName.substring(0, 3)))) {
                    return syllableToCharMap[key];
                }
            }
            
            // 4. 首字母匹配（保底）
            const firstLetter = lowerName.charAt(0);
            return syllableToCharMap[firstLetter] || ['安', '明', '华'];
        }

        // 🔧 修复后的音韵匹配函数 - 避免重复"安"和"然"
        function generatePhoneticMatches(firstname) {
            const matches = [];
            const firstChars = findBestMatch(firstname);
            
            // 随机打乱第二个字的选择，避免总是"安"和"然"
            const shuffledSecondChars = [...diverseSecondChars].sort(() => 0.5 - Math.random());
            
            // 生成2个音韵匹配选项，使用不同的组合策略
            for (let i = 0; i < 2; i++) {
                const firstChar = firstChars[i % firstChars.length];
                const secondChar = shuffledSecondChars[i % shuffledSecondChars.length];
                
                const combinedName = firstChar + secondChar.chinese;
                const firstPinyin = getPinyinForChar(firstChar);
                const secondPinyin = secondChar.pinyin;
                
                matches.push({
                    chinese: combinedName,
                    pinyin: `${firstPinyin} ${secondPinyin}`,
                    pinyinSplit: [firstPinyin, secondPinyin],
                    english: "Phonetic match",
                    meaning: `sounds similar to "${firstname}", combining ${getPinyinForChar(firstChar)} and ${secondChar.english.toLowerCase()}`,
                    type: "phonetic"
                });
            }
            
            return matches;
        }

        // 获取汉字的拼音
        function getPinyinForChar(char) {
            // 首先在 diverseSecondChars 中查找
            const foundInSecond = diverseSecondChars.find(item => item.chinese === char);
            if (foundInSecond) return foundInSecond.pinyin;
            
            // 默认拼音映射
            const defaultPinyin = {
                '安': 'ān', '明': 'míng', '华': 'huá', '文': 'wén', '雅': 'yǎ',
                '强': 'qiáng', '博': 'bó', '宇': 'yǔ', '然': 'rán', '涵': 'hán',
                '德': 'dé', '达': 'dá', '丹': 'dān', '克': 'kè', '里': 'lǐ',
                '斯': 'sī', '特': 'tè', '尔': 'ěr', '森': 'sēn', '坦': 'tǎn',
                '乔': 'qiáo', '若': 'ruò', '卓': 'zhuó', '历': 'lì', '爱': 'ài',
                '美': 'měi', '米': 'mǐ', '贝': 'bèi', '思': 'sī', '娜': 'nà',
                '瑞': 'ruì', '罗': 'luó', '艾': 'ài', '西': 'xī', '汤': 'tāng',
                '威': 'wēi', '凯': 'kǎi', '康': 'kāng', '海': 'hǎi', '汉': 'hàn',
                '刚': 'gāng', '高': 'gāo', '格': 'gé', '杰': 'jié', '吉': 'jí',
                '李': 'lǐ', '林': 'lín', '刘': 'liú', '马': 'mǎ', '彭': 'péng',
                '潘': 'pān', '保': 'bǎo', '奇': 'qí', '琪': 'qí', '泽': 'zé',
                '志': 'zhì', '智': 'zhì', '恩': 'ēn', '宁': 'níng', '奥': 'ào',
                '欧': 'ōu', '优': 'yōu', '雨': 'yǔ', '悦': 'yuè', '希': 'xī',
                '夏': 'xià', '维': 'wéi', '伟': 'wěi', '王': 'wáng', '峰': 'fēng',
                '辉': 'huī', '涛': 'tāo', '磊': 'lěi', '鹏': 'péng'
            };
            
            return defaultPinyin[char] || 'míng';
        }

        // 为组合名字生成解释的函数
        function generateNameExplanation(chinese, english, meaning, isManual = false) {
            const chars = Array.from(chinese);
            
            // 检查是否为手动输入
            if (isManual) {
                const manualTemplates = [
                    "Like the harmony of wind and water flowing together in perfect balance, this chosen name carries the essence of personal significance and cultural beauty",
                    "As graceful as morning mist dancing over mountain peaks, this name whispers of individual meaning and timeless elegance",
                    "Like precious gems reflecting the light of ancient wisdom, this personally selected name shimmers with unique significance",
                    "As enduring as the stars that guide travelers through the night, this name embodies personal choice and cultural heritage",
                    "Like the gentle strength of willow branches swaying in spring breeze, this name carries personal meaning and natural grace",
                    "As pure as mountain springs and as profound as ancient poetry, this chosen name resonates with individual significance",
                    "Like the elegant dance of cranes above tranquil lakes, this name flows with personal meaning and eternal beauty",
                    "As radiant as the first light of dawn breaking over distant hills, this name glows with chosen significance and cultural depth"
                ];

                const blessingTemplates = [
                    "May your path be illuminated by wisdom and guided by the unique meaning you have chosen",
                    "May you find joy in the personal significance of your name and strength in its cultural roots",
                    "May your chosen name bring you peace and reflect the beauty of your cultural journey",
                    "May this name be a source of pride and connection to both your personal story and Chinese heritage",
                    "May your name serve as a bridge between cultures and a symbol of your unique identity"
                ];

                const randomPoetic = manualTemplates[Math.floor(Math.random() * manualTemplates.length)];
                const randomBlessing = blessingTemplates[Math.floor(Math.random() * blessingTemplates.length)];

                return {
                    literal: english,
                    poetic: randomPoetic,
                    cultural: "Reflects the personal choice to embrace Chinese culture and tradition",
                    blessing: randomBlessing,
                    combined: `${randomPoetic}. In choosing this name, you connect with the rich tapestry of Chinese culture while maintaining your unique identity. ${randomBlessing}.`
                };
            }
            
            // 为组合名字生成诗意解释
            const poeticTemplates = [
                `Like the harmony of wind and water, this name flows with the grace of ancient poetry, embodying the essence of ${english.toLowerCase()}`,
                `As graceful as morning mist dancing over mountain peaks, this name whispers of ${english.toLowerCase()}, bringing forth timeless beauty`,
                `Like precious gems reflecting the light of ancient wisdom, this name shimmers with the spirit of ${english.toLowerCase()}`,
                `As enduring as the stars that guide travelers through the night, this name embodies ${english.toLowerCase()}, illuminating the path ahead`,
                `Like the gentle strength of willow branches swaying in spring breeze, this name carries the soul of ${english.toLowerCase()}`,
                `As pure as mountain springs and as profound as ancient poetry, this name resonates with the meaning of ${english.toLowerCase()}`,
                `Like the elegant dance of cranes above tranquil lakes, this name flows with the eternal grace of ${english.toLowerCase()}`,
                `As radiant as the first light of dawn breaking over distant hills, this name glows with the significance of ${english.toLowerCase()}`
            ];
            
            const blessingTemplates = [
                "May your path be illuminated by wisdom and guided by virtue, like a gentle river flowing toward the vast ocean of possibilities",
                "May you find joy in simple pleasures and strength in adversity, as steady as ancient mountains and as free as soaring eagles",
                "May your spirit soar like eagles and your heart remain pure as jade, bringing light to all who cross your path",
                "May you be blessed with abundant happiness and lasting peace, like a garden where flowers bloom in every season",
                "May your life be filled with meaningful connections and noble achievements, as beautiful as calligraphy written with golden ink",
                "May you carry the light of hope wherever your journey leads, like a lantern guiding travelers through the darkest nights",
                "May wisdom be your companion and kindness your guide, as constant as the North Star in the vast heavens above"
            ];
            
            const randomPoetic = poeticTemplates[Math.floor(Math.random() * poeticTemplates.length)];
            const randomBlessing = blessingTemplates[Math.floor(Math.random() * blessingTemplates.length)];
            
            // 合并成一段流畅的诗意文字
            const combinedText = `${randomPoetic}. In the tapestry of Chinese culture, it represents the timeless values of harmony, wisdom, and virtue. ${randomBlessing}.`;
            
            return {
                literal: english,
                poetic: randomPoetic,
                cultural: "Reflects the timeless values of Chinese culture and tradition",
                blessing: randomBlessing,
                combined: combinedText
            };
        }

        let selectedSurname = null;
        let selectedGivenName = null;
        let currentStep = 1;
        let currentSurnameOptions = [];
        let currentNameOptions = [];
        let usedSurnameIndices = [];
        let usedNameIndices = [];

        // Update UI for current step
        function updateStepIndicators() {
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById(`step${i}-indicator`);
                if (i <= currentStep) {
                    indicator.className = 'step-indicator flex items-center justify-center w-10 h-10 rounded-full border-2 bg-purple-600 border-purple-600 text-white transition-colors';
                } else {
                    indicator.className = 'step-indicator flex items-center justify-center w-10 h-10 rounded-full border-2 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-400 transition-colors';
                }
            }

            const descriptions = [
                'Step 1: Enter your surname',
                'Step 2: Enter your first name',
                'Step 3: Your Chinese name'
            ];
            document.getElementById('step-description').textContent = descriptions[currentStep - 1];

            // Update navigation buttons
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            if (currentStep === 1) {
                prevBtn.classList.add('hidden');
            } else {
                prevBtn.classList.remove('hidden');
            }

            if (currentStep === 3 || (currentStep === 2 && !selectedGivenName) || (currentStep === 1 && !selectedSurname)) {
                nextBtn.classList.add('hidden');
            } else {
                nextBtn.classList.remove('hidden');
            }
        }

        function showStep(step) {
            // Hide all steps
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`step${i}`).classList.add('hidden');
            }
            // Show target step
            document.getElementById(`step${step}`).classList.remove('hidden');
            currentStep = step;
            updateStepIndicators();
        }

        function goToPreviousStep() {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        }

        function goToNextStep() {
            if (currentStep === 1 && selectedSurname) {
                showStep(2);
            } else if (currentStep === 2 && selectedGivenName) {
                displayFinalName();
                showStep(3);
            }
        }

        // 高级语音相似度算法
        function calculatePhoneticSimilarity(inputName, chinesePinyin) {
            const input = inputName.toLowerCase();
            const pinyin = chinesePinyin.toLowerCase().replace(/[āáǎàēéěèīíǐìōóǒòūúǔù]/g, function(match) {
                const accents = {
                    'ā': 'a', 'á': 'a', 'ǎ': 'a', 'à': 'a',
                    'ē': 'e', 'é': 'e', 'ě': 'e', 'è': 'e',
                    'ī': 'i', 'í': 'i', 'ǐ': 'i', 'ì': 'i',
                    'ō': 'o', 'ó': 'o', 'ǒ': 'o', 'ò': 'o',
                    'ū': 'u', 'ú': 'u', 'ǔ': 'u', 'ù': 'u'
                };
                return accents[match] || match;
            });

            let score = 0;

            // 1. 精确匹配开头音素 (最高权重)
            if (input.charAt(0) === pinyin.charAt(0)) {
                score += 20;
            }

            // 2. 声母相似性匹配
            const initialMappings = [
                ['b', 'p'], ['d', 't'], ['g', 'k'], ['j', 'q', 'x', 'zh', 'ch', 'sh'],
                ['z', 'c', 's'], ['f', 'h'], ['l', 'r'], ['m', 'n'], ['w', 'v']
            ];

            for (let group of initialMappings) {
                if (group.includes(input.charAt(0)) && group.includes(pinyin.charAt(0))) {
                    score += 12;
                    break;
                }
            }

            // 3. 元音匹配 (重要)
            const inputVowels = input.match(/[aeiou]/g) || [];
            const pinyinVowels = pinyin.match(/[aeiou]/g) || [];
            let vowelMatches = 0;
            for (let vowel of inputVowels) {
                if (pinyinVowels.includes(vowel)) vowelMatches++;
            }
            score += vowelMatches * 4;

            // 4. 结尾音素匹配
            if (input.slice(-1) === pinyin.slice(-1)) score += 6;
            if (input.slice(-2) === pinyin.slice(-2)) score += 4;

            // 5. 整体相似度
            let commonChars = 0;
            for (let char of input) {
                if (pinyin.includes(char)) commonChars++;
            }
            score += commonChars * 2;

            // 6. 长度相似度
            const lengthDiff = Math.abs(input.length - pinyin.length);
            if (lengthDiff <= 1) score += 3;
            else if (lengthDiff <= 2) score += 1;

            return score;
        }

        function generateSurnameSuggestions() {
            const surname = document.getElementById('surname-input').value.trim();
            if (!surname) {
                showCustomAlert('请输入您的姓氏。/ Please enter your surname.');
                return;
            }

            document.getElementById('loading-surname').classList.remove('hidden');
            document.getElementById('surname-suggestions').classList.add('hidden');

            // Simulate loading delay
            setTimeout(() => {
                // 使用改进的语音匹配算法
                const scoredSurnames = chineseSurnames.map(s => ({
                    ...s, 
                    similarity: calculatePhoneticSimilarity(surname, s.pinyin)
                }));

                // 按相似度排序并分组
                scoredSurnames.sort((a, b) => b.similarity - a.similarity);
                
                // 选择前6个最佳匹配
                const bestMatches = scoredSurnames.slice(0, 6);

                currentSurnameOptions = bestMatches;
                usedSurnameIndices = [];
                displaySurnameSuggestions({suggestions: bestMatches});
                document.getElementById('loading-surname').classList.add('hidden');
            }, 1000);
        }

        function generateMoreSurnameSuggestions() {
            const surname = document.getElementById('surname-input').value.trim();
            if (!surname) {
                showCustomAlert('请先输入您的姓氏。/ Please enter your surname first.');
                return;
            }

            document.getElementById('loading-surname').classList.remove('hidden');

            setTimeout(() => {
                // 获取还未使用的姓氏
                const usedSurnames = currentSurnameOptions.map(s => s.chinese);
                const availableSurnames = chineseSurnames.filter(s => !usedSurnames.includes(s.chinese));
                
                // 从剩余的姓氏中选择5个
                const additionalSurnames = availableSurnames
                    .map(s => ({
                        ...s, 
                        similarity: calculatePhoneticSimilarity(surname, s.pinyin)
                    }))
                    .sort((a, b) => b.similarity - a.similarity)
                    .slice(0, 5);

                currentSurnameOptions = [...currentSurnameOptions, ...additionalSurnames];
                displaySurnameSuggestions({suggestions: currentSurnameOptions});
                document.getElementById('loading-surname').classList.add('hidden');
            }, 800);
        }

        function displaySurnameSuggestions(data) {
            const container = document.getElementById('surname-options');
            container.innerHTML = '';

            data.suggestions.forEach((suggestion, index) => {
                // 调整相似度分组阈值
                let badgeClass = 'similarity-low';
                let badgeText = 'Other';
                if (suggestion.similarity >= 20) {
                    badgeClass = 'similarity-high';
                    badgeText = 'High Match';
                } else if (suggestion.similarity >= 12) {
                    badgeClass = 'similarity-medium';
                    badgeText = 'Medium';
                }

                const option = document.createElement('div');
                option.className = 'bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 cursor-pointer hover:border-purple-500 hover:shadow-md transition-all duration-200 relative';
                option.innerHTML = `
                    <div class="similarity-badge ${badgeClass}">${badgeText}</div>
                    <div class="text-center">
                        <div class="text-3xl font-bold font-chinese mb-2">${suggestion.chinese}</div>
                        <div class="text-purple-600 font-semibold mb-1">${suggestion.pinyin}</div>
                        <div class="text-gray-600 dark:text-gray-400 text-sm">${suggestion.english}</div>
                    </div>
                `;
                
                option.addEventListener('click', () => {
                    selectedSurname = suggestion;
                    // Remove selection from other options
                    container.querySelectorAll('.border-purple-500').forEach(el => {
                        el.classList.remove('border-purple-500', 'bg-purple-50', 'dark:bg-purple-900');
                    });
                    // Add selection to clicked option
                    option.classList.add('border-purple-500', 'bg-purple-50', 'dark:bg-purple-900');
                    
                    updateStepIndicators();
                    
                    // Move to step 2 after selection
                    setTimeout(() => {
                        showStep(2);
                    }, 500);
                });
                
                container.appendChild(option);
            });

            document.getElementById('surname-suggestions').classList.remove('hidden');
        }

        function generateNameSuggestions() {
            const firstname = document.getElementById('firstname-input').value.trim();
            const gender = document.getElementById('gender-input').value;
            const meaning = document.getElementById('meaning-input').value.trim();
            
            if (!firstname) {
                showCustomAlert('请输入您的名字。/ Please enter your first name.');
                return;
            }

            document.getElementById('loading-name').classList.remove('hidden');
            document.getElementById('name-suggestions').classList.add('hidden');

            setTimeout(() => {
                // 1. 生成音韵匹配名字
                const phoneticMatches = generatePhoneticMatches(firstname);
                
                // 2. 生成性别常用名字
                let popularPool = [];
                if (gender === 'male') {
                    popularPool = [...genderSpecificNames.male, ...genderSpecificNames.unisex];
                } else if (gender === 'female') {
                    popularPool = [...genderSpecificNames.female, ...genderSpecificNames.unisex];
                } else {
                    popularPool = [...genderSpecificNames.male, ...genderSpecificNames.female, ...genderSpecificNames.unisex];
                }

                // 随机选择4个常用名字
                const shuffled = popularPool.sort(() => 0.5 - Math.random());
                const popularMatches = shuffled.slice(0, 4);

                currentNameOptions = [...phoneticMatches, ...popularMatches];
                displayNameSuggestionsInColumns(phoneticMatches, popularMatches);
                document.getElementById('loading-name').classList.add('hidden');
            }, 1200);
        }

        function generateMoreNameSuggestions() {
            const firstname = document.getElementById('firstname-input').value.trim();
            const gender = document.getElementById('gender-input').value;
            
            if (!firstname) {
                showCustomAlert('请先输入您的名字。/ Please enter your first name first.');
                return;
            }

            document.getElementById('loading-name').classList.remove('hidden');

            setTimeout(() => {
                // 重新生成更多选项
                generateNameSuggestions();
            }, 1000);
        }

        function displayNameSuggestionsInColumns(phoneticMatches, popularMatches) {
            const phoneticContainer = document.getElementById('phonetic-options');
            const popularContainer = document.getElementById('popular-options');
            
            phoneticContainer.innerHTML = '';
            popularContainer.innerHTML = '';

            // 显示音韵匹配选项
            phoneticMatches.forEach((suggestion, index) => {
                const option = createNameOption(suggestion, 'phonetic-match');
                phoneticContainer.appendChild(option);
            });

            // 显示常用名字选项
            popularMatches.forEach((suggestion, index) => {
                const option = createNameOption(suggestion, 'popular-name');
                popularContainer.appendChild(option);
            });

            document.getElementById('name-suggestions').classList.remove('hidden');
        }

        function createNameOption(suggestion, type) {
            const option = document.createElement('div');
            option.className = 'bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg p-4 cursor-pointer hover:border-purple-500 hover:shadow-md transition-all duration-200 relative';
            
            const badgeClass = type === 'phonetic-match' ? 'phonetic-match' : 'popular-name';
            const badgeText = type === 'phonetic-match' ? '🎵' : '⭐';
            
            option.innerHTML = `
                <div class="similarity-badge ${badgeClass}">${badgeText}</div>
                <div class="text-center">
                    <div class="text-2xl font-bold font-chinese mb-2">${suggestion.chinese}</div>
                    <div class="text-purple-600 font-semibold mb-1 text-sm">${suggestion.pinyin}</div>
                    <div class="text-gray-600 dark:text-gray-400 text-xs mb-1">${suggestion.english}</div>
                    <div class="text-gray-500 dark:text-gray-500 text-xs">${suggestion.meaning}</div>
                </div>
            `;
            
            option.addEventListener('click', () => {
                selectedGivenName = suggestion;
                // Remove selection from all options
                document.querySelectorAll('#phonetic-options .border-purple-500, #popular-options .border-purple-500').forEach(el => {
                    el.classList.remove('border-purple-500', 'bg-purple-50', 'dark:bg-purple-900');
                });
                // Add selection to clicked option
                option.classList.add('border-purple-500', 'bg-purple-50', 'dark:bg-purple-900');
                
                updateStepIndicators();
                
                // Move to step 3 after selection
                setTimeout(() => {
                    displayFinalName();
                    showStep(3);
                }, 500);
            });
            
            return option;
        }

        function displayFinalName() {
            if (!selectedSurname || !selectedGivenName) return;

            const fullName = selectedSurname.chinese + selectedGivenName.chinese;
            
            // 使用正确的拼音分解
            const surnamePinyin = selectedSurname.pinyin.toLowerCase();
            const givenNameChars = Array.from(selectedGivenName.chinese);
            
            // 获取正确的拼音分解
            let givenNamePinyins = [];
            if (selectedGivenName.pinyinSplit) {
                givenNamePinyins = selectedGivenName.pinyinSplit;
            } else {
                // 如果没有预定义的拼音分解，自动生成
                givenNamePinyins = [selectedGivenName.pinyin.toLowerCase()];
            }

            // 生成诗意英文解释 - 检查是否为手动输入
            const isManual = selectedGivenName.isManual || false;
            const explanation = generateNameExplanation(
                selectedGivenName.chinese, 
                selectedGivenName.english, 
                selectedGivenName.meaning,
                isManual
            );

            const container = document.getElementById('final-name-display');
            container.innerHTML = `
                <div class="name-card decorative-pattern" id="name-card-export">
                    <div class="text-center mb-8">
                        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-2">
                            我的中文名 My Chinese Name
                        </h3>
                    </div>
                    
                    <div class="landscape-layout">
                        <div class="rice-section">
                            <div class="flex justify-center items-center mb-4">
                                <div class="mx-2">
                                    <div class="individual-pinyin">${surnamePinyin}</div>
                                    <div class="rice-grid">
                                        <div class="diagonal1"></div>
                                        <div class="diagonal2"></div>
                                        <div class="character">${selectedSurname.chinese}</div>
                                    </div>
                                </div>
                                ${givenNameChars.map((char, index) => `
                                    <div class="mx-2">
                                        <div class="individual-pinyin">${givenNamePinyins[index] || givenNamePinyins[0]}</div>
                                        <div class="rice-grid">
                                            <div class="diagonal1"></div>
                                            <div class="diagonal2"></div>
                                            <div class="character">${char}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="text-center text-gray-600 dark:text-gray-400 text-sm">
                                练习书写您的中文名字<br>Practice writing your Chinese name
                            </div>
                        </div>
                        
                        <div class="meaning-section">
                            <div class="handwriting-quote">
                                ${explanation.combined || explanation.poetic + '. In the tapestry of Chinese culture, it represents the timeless values of harmony, wisdom, and virtue. ' + explanation.blessing + '.'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function resetApp() {
            selectedSurname = null;
            selectedGivenName = null;
            currentSurnameOptions = [];
            currentNameOptions = [];
            usedSurnameIndices = [];
            usedNameIndices = [];
            document.getElementById('surname-input').value = '';
            document.getElementById('firstname-input').value = '';
            document.getElementById('gender-input').value = '';
            document.getElementById('meaning-input').value = '';
            document.getElementById('surname-suggestions').classList.add('hidden');
            document.getElementById('name-suggestions').classList.add('hidden');
            showStep(1);
        }

        function showManualInput() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4">
                    <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-4">手动输入中文名字 / Manual Input Chinese Name</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                中文名字 / Chinese Name
                            </label>
                            <input type="text" 
                                   id="manual-chinese" 
                                   class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent" 
                                   placeholder="例如: 志强"
                                   autocomplete="off">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                拼音 / Pinyin
                            </label>
                            <input type="text" 
                                   id="manual-pinyin" 
                                   class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-purple-500 focus:border-transparent" 
                                   placeholder="例如: zhì qiáng (用空格分隔每个字)"
                                   autocomplete="off">
                        </div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">
                            请输入中文名字和对应的拼音，拼音请用空格分隔每个字。<br>
                            Please enter the Chinese name and corresponding pinyin, separated by spaces.
                        </p>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded" onclick="this.closest('.fixed').remove()">取消 / Cancel</button>
                        <button class="px-4 py-2 bg-purple-500 text-white hover:bg-purple-600 rounded" onclick="processManualInput()">确认 / Confirm</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function processManualInput() {
            const chinese = document.getElementById('manual-chinese').value.trim();
            const pinyin = document.getElementById('manual-pinyin').value.trim();

            if (!chinese) {
                showCustomAlert('请输入中文名字。/ Please enter Chinese name.');
                return;
            }

            if (!pinyin) {
                showCustomAlert('请输入拼音。/ Please enter pinyin.');
                return;
            }

            // 验证汉字和拼音数量是否匹配
            const chineseChars = Array.from(chinese);
            const pinyinArray = pinyin.split(/\s+/).filter(p => p.length > 0);

            if (chineseChars.length !== pinyinArray.length) {
                showCustomAlert(`汉字数量 (${chineseChars.length}) 与拼音数量 (${pinyinArray.length}) 不匹配，请检查。/ Number of Chinese characters (${chineseChars.length}) does not match number of pinyin syllables (${pinyinArray.length}), please check.`);
                return;
            }

            selectedGivenName = {
                chinese: chinese,
                pinyin: pinyin,
                pinyinSplit: pinyinArray,
                english: "Meaningful name",
                meaning: "auspicious and meaningful",
                isManual: true
            };

            // Close modal
            const modal = document.querySelector('.fixed');
            if (modal) modal.remove();

            updateStepIndicators();

            // Move to step 3
            setTimeout(() => {
                displayFinalName();
                showStep(3);
            }, 300);
        }

        function downloadNameAsText() {
            if (!selectedSurname || !selectedGivenName) {
                showCustomAlert('请先生成中文名字。/ Please generate Chinese name first.');
                return;
            }
            
            const fullName = selectedSurname.chinese + selectedGivenName.chinese;
            const surnamePinyin = selectedSurname.pinyin;
            
            let givenNamePinyin;
            if (selectedGivenName.pinyinSplit) {
                givenNamePinyin = selectedGivenName.pinyinSplit.join(' ');
            } else {
                givenNamePinyin = selectedGivenName.pinyin;
            }
            
            const fullPinyin = surnamePinyin + ' ' + givenNamePinyin;
            const isManual = selectedGivenName.isManual || false;
            const explanation = generateNameExplanation(
                selectedGivenName.chinese, 
                selectedGivenName.english, 
                selectedGivenName.meaning,
                isManual
            );
            
            const content = `我的中文名字 / My Chinese Name

中文全名 / Full Chinese Name: ${fullName}
姓氏 / Surname: ${selectedSurname.chinese} (${selectedSurname.pinyin})
名字 / Given Name: ${selectedGivenName.chinese} (${givenNamePinyin})

拼音 / Pinyin: ${fullPinyin}

名字含义解释 / Name Meaning:
${explanation.combined || (explanation.poetic + '. In the tapestry of Chinese culture, it represents the timeless values of harmony, wisdom, and virtue. ' + explanation.blessing + '.')}

Generated by 中文名字工坊 Chinese NameCraft
生成时间 / Generated: ${new Date().toLocaleString()}`;
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `chinese-name-${fullName}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-auto">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-purple-500 text-white hover:bg-purple-600 rounded" onclick="this.closest('.fixed').remove()">确定 / OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Initialize
        updateStepIndicators();
    </script>


</body></html>